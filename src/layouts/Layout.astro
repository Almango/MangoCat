---
import { siteConfig } from '../config';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
const { title, favicon } = siteConfig;
const { pagetitle, children } = Astro.props;
// 使用页面传递的标题，如果没有则使用默认标题
const pageTitle = pagetitle || title;
---

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{pageTitle}</title>
    <link rel="icon" type="image/svg+xml" href={favicon} />
    <script>
    // 主题切换功能的内联实现
    // 定义主题类型
    const Theme = {
        LIGHT: 'light',
        DARK: 'dark',
        SYSTEM: 'system'
    };

    // 获取主题设置
    const getTheme = () => {
        return localStorage.getItem('theme') || Theme.SYSTEM;
    };

    // 获取实际的主题值
    const getActualTheme = () => {
        const theme = getTheme();
        if (theme === Theme.SYSTEM) {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? Theme.DARK : Theme.LIGHT;
        }
        return theme;
    };

    // 更新文档的类名和data-theme属性
    const updateThemeClass = () => {
        const actualTheme = getActualTheme();
        const htmlElement = document.documentElement;
        htmlElement.classList.remove(Theme.LIGHT, Theme.DARK);
        htmlElement.classList.add(actualTheme);
        // 设置data-theme属性以支持astro-expressive-code
        htmlElement.setAttribute('data-theme', actualTheme);
    };

    // 立即初始化主题，避免页面闪烁
    updateThemeClass();

    // 监听系统主题变化
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    mediaQuery.addEventListener('change', updateThemeClass);
    </script>
  </head>
  <body>
    <!-- 共享的Header组件 -->
    <Header />
    <slot />
    <!-- 共享的Footer组件 -->
    <Footer />
  </body>
</html>
